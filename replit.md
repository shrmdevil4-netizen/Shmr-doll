# Discord Gemini Bot Project

## نظرة عامة
بوت ديسكورد ذكي يستخدم Google Gemini AI (2.0 Flash) للرد على الأسئلة ومساعدة المستخدمين بذكاء اصطناعي متقدم مع دعم Slash Commands ونظام الرد التلقائي في القنوات المحددة.

## آخر التحديثات
- **تاريخ**: أكتوبر 18، 2025
- تحويل جميع الأوامر إلى Slash Commands
- إضافة نظام الرد التلقائي في القنوات المحددة
- إصلاح تكامل Gemini AI للعمل بشكل صحيح
- دمج البوت مع سيرفر Express في server/index.ts

## البنية المعمارية

### الملفات الرئيسية
1. **server/index.ts** - خادم Express الرئيسي الذي يشغل البوت
2. **client.js** - منطق البوت الأساسي ومعالجة الرسائل والأوامر
3. **tokens.js** - إدارة وتحميل المفاتيح السرية
4. **package.json** - المكتبات والإعدادات
5. **render.yaml** - إعدادات النشر على Render

### المكتبات الرئيسية
- **discord.js v14** - للتواصل مع Discord API
- **@google/genai** - Google Gemini AI SDK
- **express** - خادم HTTP للتطبيق
- **dotenv** - إدارة المتغيرات البيئية

### القدرات والمميزات

#### 1. ذكاء اصطناعي متقدم
- استخدام Gemini 2.0 Flash للردود السريعة والدقيقة
- فهم السياق من خلال حفظ سجل المحادثات (آخر 10 تبادلات)
- دعم الأسئلة المعقدة والبحث الذكي
- ردود باللغة العربية والإنجليزية تلقائياً

#### 2. نظام Slash Commands
جميع الأوامر الآن Slash Commands تظهر عند كتابة `/`:

**الأوامر الأساسية:**
- `/help` - عرض قائمة المساعدة
- `/ask` - سؤال البوت مباشرة
- `/clear` - مسح سجل المحادثة
- `/ping` - فحص سرعة الاستجابة

**أوامر الإدارة (تتطلب صلاحية Manage Channels):**
- `/setchannel` - تحديد قناة للرد التلقائي
- `/removechannel` - إزالة قناة من الرد التلقائي
- `/listchannels` - عرض القنوات المحددة
- `/clearallchannels` - إزالة جميع القنوات المحددة

#### 3. نظام الرد التلقائي
- يمكن للمشرفين تحديد قنوات معينة باستخدام `/setchannel`
- البوت يرد تلقائياً على **جميع** الرسائل في القنوات المحددة
- لا حاجة لذكر البوت أو استخدام أوامر في القنوات المحددة
- مثالي لإنشاء قنوات مخصصة للدردشة مع الذكاء الاصطناعي

#### 4. طرق التفاعل المتعددة
1. **القنوات المحددة**: اكتب مباشرة في القناة المحددة والبوت يرد تلقائياً
2. **ذكر البوت**: `@اسم_البوت سؤالك` في أي قناة
3. **الرد على رسائل البوت**: رد مباشرة على رسالة سابقة للبوت
4. **Slash Commands**: استخدم `/ask` في أي مكان

### المتغيرات البيئية المطلوبة
- `DISCORD_TOKEN` - رمز بوت Discord
- `GEMINI_API_KEY` - مفتاح Google Gemini API
- `PORT` - منفذ الخادم (الافتراضي: 5000)

### الأمان
- المفاتيح السرية محفوظة في متغيرات البيئة
- لا يتم تخزين أي بيانات حساسة في الكود
- سجل المحادثات مؤقت ومحدود ومحفوظ في الذاكرة فقط
- أوامر الإدارة محمية بصلاحيات Discord

### كيفية التشغيل محلياً
```bash
npm install
npm run dev
```

### كيفية النشر على Render
1. إنشاء حساب على Render.com
2. ربط المستودع
3. إضافة متغيرات البيئة (DISCORD_TOKEN، GEMINI_API_KEY)
4. النشر التلقائي من render.yaml

## ملاحظات تقنية
- البوت يحتاج إلى تفعيل "MESSAGE CONTENT INTENT" في Discord Developer Portal
- Slash Commands تُسجل عالمياً (globally) وقد تستغرق ساعة للظهور في جميع السيرفرات
- سجل المحادثات والقنوات المحددة يُحفظان في الذاكرة (يُمسحان عند إعادة التشغيل)
- الردود الطويلة (>2000 حرف) تُقسم تلقائياً
- البوت مدمج مع خادم Express ويعمل على المنفذ 5000

## أمثلة الاستخدام

### إعداد قناة للدردشة الذكية
1. أنشئ قناة جديدة في السيرفر (مثلاً: `ai-chat`)
2. استخدم الأمر `/setchannel` واختر القناة
3. الآن أي رسالة في تلك القناة سيرد عليها البوت تلقائياً!

### سؤال سريع
استخدم `/ask` في أي مكان ثم اكتب سؤالك

### مسح سجل المحادثة
استخدم `/clear` لبداية محادثة جديدة

## التحسينات المستقبلية المقترحة
- إضافة قاعدة بيانات لحفظ المحادثات والقنوات المحددة بشكل دائم
- دعم الصور والملفات في المحادثات
- إضافة نظام تحكم في معدل الاستخدام لتجنب الإفراط في استدعاءات API
- إحصائيات الاستخدام وتحليلات
- دعم تخصيص شخصية البوت لكل سيرفر
